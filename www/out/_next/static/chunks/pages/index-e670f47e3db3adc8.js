(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[405],{8312:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return n(7745)}])},7745:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return p}});var i=n(5893),l=n(6664),r=n(1291),a=n(4887),s=n(7294),o=n(3835);let u=(0,o.K5)({links:[(0,o.N8)({url:"https://billing-api.troybroussard.com/trpc"})]});var c=n(2920);let d=(0,r.J)("pk_live_4bQ1e2d5RKyIon51HcMcwf8S");function m(e){let t=(0,l.useStripe)(),n=(0,l.useElements)(),r=async i=>{i.preventDefault();let r=a.Z.parse(location.search);if(!t||!n)return;let s=n.getElement(l.CardElement),o=n.getElement(l.AddressElement);if(!s||!o||!r.customerId)return;let d=await o.getValue(),m=await t.createPaymentMethod({type:"card",card:s,billing_details:{...d.value}});m.paymentMethod&&(await u.updateDefaultPaymentMethod.mutate({stripeCustomerId:r.customerId,stripePaymentMethodId:m.paymentMethod.id}),(0,c.Am)("Billing successfully updated",{type:"success"}),e.navigateToThankYou(),console.log("Done!"))};return(0,i.jsxs)("form",{onSubmit:r,children:[(0,i.jsx)(l.CardElement,{}),(0,i.jsx)(l.AddressElement,{options:{mode:"billing",fields:{phone:"always"},validation:{phone:{required:"always"}},defaultValues:{name:e.name}}}),(0,i.jsx)("button",{children:"Update my Billing"})]})}function p(){let[e,t]=(0,s.useState)(null),[n,r]=(0,s.useState)(!1);if((0,s.useEffect)(()=>{let e=a.Z.parse(location.search);(async()=>{if(e.customerId)try{let n=await u.getStripeUserInfo.query({stripeCustomerId:e.customerId});if(!n){(0,c.Am)("Billing not found, please reach out to help@learnistic.com",{type:"error",autoClose:!1});return}t(n)}catch(e){(0,c.Am)("Billing not found. Please reach out to help@learnistic.com",{type:"error",autoClose:!1})}})()},[]),e)return(console.log(e),n)?(0,i.jsxs)("div",{style:{width:"100vw",height:"100vh",display:"flex",justifyContent:"center",alignItems:"center",flexDirection:"column"},children:[(0,i.jsx)("h1",{children:"Thanks!"}),(0,i.jsx)("h3",{style:{marginTop:0},children:"Your billing information is now up to date."})," "]}):(0,i.jsx)(l.Elements,{stripe:d,children:(0,i.jsx)("div",{style:{marginLeft:"calc(50vw - 250px)",marginTop:200},children:(0,i.jsx)("div",{children:(0,i.jsx)(m,{name:e.name,navigateToThankYou:function(){r(!0)}})})})})}}},function(e){e.O(0,[982,774,888,179],function(){return e(e.s=8312)}),_N_E=e.O()}]);